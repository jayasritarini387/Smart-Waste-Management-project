<!DOCTYPE html>
<html>
<head>
<title>Smart Waste Management</title>

<style>
body{
  font-family: Arial;
  margin: 0;
  background: url("https://freedesignfile.com/upload/2016/10/Green-Background-Green-Recycle-Symbol-Stock-Photo.jpg") no-repeat center center fixed;
  background-size: cover;
}
header{
  background:#2e7d32;
  color:#fff;
  padding:15px;
  text-align:center;
}
.container{
  max-width:480px;
  margin:20px auto;
  background:#ffffffdd;
  padding:20px;
  border-radius:8px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:10px;
}
button{
  background:#43a047;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{background:#2e7d32}
.back{background:#777}
.page{display:none}
.status{
  padding:4px 8px;
  border-radius:10px;
  color:#fff;
  font-size:12px;
}
.pending{background:orange}
.collected{background:green}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
td,th{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
</style>
</head>

<body>

<header>
<h2>üåç Smart Waste Management System</h2>
</header>

<!-- ROLE -->
<div class="container page" id="rolePage">
<h3>Select Role</h3>
<button onclick="showPage('registerPage')">üë§ User</button>
<button onclick="showPage('collectorRegisterPage')">üöõ Collector</button>
<button onclick="showPage('adminLoginPage')">üßë‚Äçüíº Admin</button>
</div>

<!-- USER REGISTER -->
<div class="container page" id="registerPage">
<h3>User Register</h3>
<input id="regUser" placeholder="Username">
<input id="regPass" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<p id="regMsg"></p>
<button onclick="showPage('loginPage')">Login</button>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- USER LOGIN -->
<div class="container page" id="loginPage">
<h3>User Login</h3>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- COLLECTOR REGISTER -->
<div class="container page" id="collectorRegisterPage">
<h3>Collector Register</h3>
<input id="colRegId" placeholder="Collector ID">
<input id="colRegPass" type="password" placeholder="Password">
<button onclick="collectorRegister()">Register</button>
<p id="colRegMsg"></p>
<button onclick="showPage('collectorLoginPage')">Login</button>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- COLLECTOR LOGIN -->
<div class="container page" id="collectorLoginPage">
<h3>Collector Login</h3>
<input id="collectorId" placeholder="Collector ID">
<input id="collectorPass" type="password" placeholder="Password">
<button onclick="collectorLogin()">Login</button>
<p id="collectorMsg"></p>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- ADMIN LOGIN -->
<div class="container page" id="adminLoginPage">
<h3>Admin Login</h3>
<input id="adminUser" placeholder="Admin Username">
<input id="adminPass" type="password" placeholder="Admin Password">
<button onclick="adminLogin()">Login</button>
<p id="adminMsg"></p>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- USER DASHBOARD -->
<div class="container page" id="userPage">
<h3>Book Plastic Pickup</h3>
<select id="plastic">
<option value="">Plastic Type</option>
<option>Bottles</option>
<option>Bags</option>
<option>Containers</option>
</select>
<input id="weight" type="number" placeholder="Weight (kg)">
<button onclick="getLocation()">üìç Capture Location</button>
<p id="locText"></p>
<h4>üí≥ Payment</h4>
<select id="payment">
<option value="">Select Payment</option>
<option>UPI</option>
<option>Card</option>
<option>Cash</option>
</select>
<button onclick="bookPickup()">Book Pickup</button>
<p id="bookMsg"></p>
<h4>‚≠ê Reward Points: <span id="points">0</span></h4>
<h4>My Pickups</h4>
<table>
<tr><th>Plastic</th><th>Status</th></tr>
<tbody id="userTable"></tbody>
</table>
<button onclick="logout()">Logout</button>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- COLLECTOR DASHBOARD -->
<div class="container page" id="collectorPage">
<h3>Collector Dashboard</h3>
<table>
<tr>
<th>User</th>
<th>Plastic</th>
<th>User Location</th>
<th>Status</th>
<th>Action</th>
</tr>
<tbody id="collectorTable"></tbody>
</table>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<!-- ADMIN DASHBOARD -->
<div class="container page" id="adminPage">
<h3>Admin Analytics</h3>
<p>Total Pickups: <b id="total"></b></p>
<p>Pending: <b id="pending"></b></p>
<p>Collected: <b id="collected"></b></p>
<p>Total Reward Points: <b id="totalPoints"></b></p>
<button class="back" onclick="showPage('rolePage')">‚¨Ö Back</button>
</div>

<script>
// PAGE CONTROL
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";
}
showPage("rolePage");

// STORAGE FUNCTIONS
const getUsers = ()=>JSON.parse(localStorage.getItem("users"))||{};
const saveUsers = u=>localStorage.setItem("users",JSON.stringify(u));
const getBookings = ()=>JSON.parse(localStorage.getItem("bookings"))||[];
const saveBookings = b=>localStorage.setItem("bookings",JSON.stringify(b));
const getCollectors = ()=>JSON.parse(localStorage.getItem("collectors"))||{};
const saveCollectors = c=>localStorage.setItem("collectors",JSON.stringify(c));
const getPoints = ()=>JSON.parse(localStorage.getItem("points"))||{};
const savePoints = p=>localStorage.setItem("points",JSON.stringify(p));

let currentUser = null;
let gps = {};

// DEFAULT ADMIN
const ADMIN_USER="admin";
const ADMIN_PASS="admin123";

// USER REGISTER
function register(){
  let u=regUser.value,p=regPass.value,users=getUsers();
  if(!u||!p){regMsg.textContent="‚ùå Fill all"; return;}
  if(users[u]){regMsg.textContent="‚ùå User exists"; return;}
  users[u]=p; saveUsers(users);
  let pts=getPoints(); pts[u]=0; savePoints(pts);
  regMsg.textContent="‚úÖ Registered successfully";
}

// USER LOGIN
function login(){
  let users=getUsers();
  if(users[loginUser.value]===loginPass.value){
    currentUser=loginUser.value;
    showPage("userPage");
    loadUser();
  } else loginMsg.textContent="‚ùå Invalid login";
}

// ADMIN LOGIN
function adminLogin(){
  if(adminUser.value===ADMIN_USER && adminPass.value===ADMIN_PASS){
    openAdmin();
  } else adminMsg.textContent="‚ùå Invalid admin credentials";
}

// COLLECTOR REGISTER
function collectorRegister(){
  let id = colRegId.value, pass = colRegPass.value;
  let collectors = getCollectors();
  if(!id || !pass){ colRegMsg.textContent="‚ùå Fill all"; return;}
  if(collectors[id]){ colRegMsg.textContent="‚ùå Collector exists"; return;}
  collectors[id] = pass;
  saveCollectors(collectors);
  colRegMsg.textContent="‚úÖ Collector Registered";
}

// COLLECTOR LOGIN
function collectorLogin(){
  let collectors = getCollectors();
  if(collectors[collectorId.value]===collectorPass.value){
    showPage("collectorPage");
    loadCollector();
  } else collectorMsg.textContent="‚ùå Invalid credentials";
}

// GPS USER
function getLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    gps=pos.coords;
    locText.textContent="üìç Location Captured";
  })
}

// BOOK PICKUP
function bookPickup(){
  if(!plastic.value||!weight.value||!payment.value||!gps.latitude){
    bookMsg.textContent="‚ùå Fill all details"; return;
  }
  let b=getBookings();
  b.push({
    user:currentUser,
    plastic:plastic.value,
    weight:weight.value,
    status:"pending",
    location:gps
  });
  saveBookings(b);
  bookMsg.textContent="‚úÖ Pickup Booked";
  loadUser();
}

// USER DATA
function loadUser(){
  let rows="";
  getBookings().forEach(b=>{
    if(b.user===currentUser){
      rows+=`<tr>
        <td>${b.plastic}</td>
        <td><span class="status ${b.status}">${b.status}</span></td>
      </tr>`;
    }
  });
  userTable.innerHTML=rows;
  points.textContent=getPoints()[currentUser];
}

// COLLECTOR DASHBOARD
function loadCollector(){
  let rows="";
  getBookings().forEach((b,i)=>{
    let loc=b.location
      ? `Lat:${b.location.latitude.toFixed(3)}, Lng:${b.location.longitude.toFixed(3)}`
      : "N/A";
    rows+=`<tr>
      <td>${b.user}</td>
      <td>${b.plastic}</td>
      <td>${loc}</td>
      <td><span class="status ${b.status}">${b.status}</span></td>
      <td>
        ${b.status==="pending" ? `<button onclick="markCollected(${i})">Collected</button>` : "‚úî"}
      </td>
    </tr>`;
  });
  collectorTable.innerHTML=rows;
}

// MARK COLLECTED
function markCollected(i){
  let b=getBookings(), pts=getPoints();
  b[i].status="collected";
  pts[b[i].user] += 10;
  saveBookings(b); savePoints(pts);
  loadCollector();
}

// ADMIN DASHBOARD
function openAdmin(){
  showPage("adminPage");
  let b=getBookings(), pts=getPoints();
  total.textContent=b.length;
  pending.textContent=b.filter(x=>x.status==="pending").length;
  collected.textContent=b.filter(x=>x.status==="collected").length;
  totalPoints.textContent=Object.values(pts).reduce((a,b)=>a+b,0);
}

// LOGOUT
function logout(){
  currentUser=null;
  showPage("loginPage");
}
</script>

</body>
</html>
